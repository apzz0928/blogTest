<html lang="ko"><head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="csrf-token" content="rW67c6F891mOKpmwqwdPHqZ8iOZo4lBusu0gnVFM">

	<title>Dighty Campaign Manageri - 사이트 정보</title>
	<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">
	<link rel="stylesheet" type="text/css" href="/css/common.css">
	<link rel="stylesheet" type="text/css" href="/css/layout.css">
    <link rel="stylesheet" type="text/css" href="/css/bootstrap-datepicker.standalone.css">
    <link rel="stylesheet" type="text/css" href="/css/ace.dual-calendar.css">
	<link rel="stylesheet" type="text/css" href="/css/themes/default.css">
	<link rel="stylesheet" type="text/css" href="/css/alertify.css">
	<link rel="stylesheet" type="text/css" href="/css/bootstrap-popover.css">
        
    <script typ="text/javascript">
        var client = "파트너";
        var campaign = "캠페인";
    </script>

    <script src="/js/jquery-1.11.3.js"></script>
	<script src="/js/jquery-ui.js"></script>
	<script src="/js/bootstrap.min.js"></script>
    <script src="/js/bootstrap-tooltip.js"></script>
    <script src="/js/bootstrap-toggle.min.js"></script>
    <script src="/js/ace.tools.js"></script>
    <script src="/js/common.js"></script>
    <script src="/js/moment.min.js"></script>
    <script src="/js/highcharts.js"></script>
    <script src="/js/no-data-to-display.js"></script>
    <script src="/js/alertify.js"></script>
    <script src="/js/josa.js"></script>
    <script src="/js/alert.js"></script>
    <script src="/js/bootstrap-popover.js"></script>
    <script src="/js/bootstrap-modal.js"></script>
</head>

<body>
<div class="wrap">
    <div class="main_top_wrap" style="display: none;">
        <div class="inner">
            <span class="inner_txt">Dighty 서비스는 Chrome 최신 브라우저에 최적화 되어있습니다.</span>
            <button class="btn_line_white" onclick="location.href='https://www.google.com/intl/ko/chrome/'">Chrome 다운로드</button>
        </div>
        <a href="javascript:closeWrap();" class="btn_close"><img src="/img/top_banner_close.png" style="vertical-align:top"></a>
    </div>

	<!-- [D] HEADER -->
        <header id="header" class="dighty_header">
            <h1 class="dighty_logo">
                <a href="/" class="dighty_logo_link">Dighty Campaign Manager</a>
                <a href="/" class="dighty_brand"><img src="/img/ace_cdp_cm.png" style="vertical-align:top"></a>
            </h1>

            <div class="cm_family" id="brand_layer">
                <a href="/" class="tit"><img src="/img/cm.png"><span class="ico_arr">목록 열기 버튼</span></a>
                <ul class="cm_lst_family">
                    <li><a href="https://am.dighty.com" target="_blank"><img src="/img/am.png"></a></li>
                </ul>
            </div>
            <div class="cm_info">
                <a href="#" class="info_id_link"><strong>amzsoft </strong>님</a>
                <a href="/auth/logout"><button type="submit" class="btn_logout"><span>Logout</span></button></a>
            </div>
        </header>
        <!-- //[D] HEADER -->	<!-- container -->
	<div id="container" class="bg-middle">
		<!-- [D] NAV -->
        <nav class="dighty_nav">
            <div class="dighty_nav_inner" id="accordian" style="min-height: 600px; height: 892px;">
                <ul class="nav">
		                                <li class="nav_item ">
                        <a href="/dashboard" class="nav_link"><span class="ico_nav_ico1"></span>대시보드</a>
                        <ul class="nav_sub">
			                                            <li class="nav_sub_item "><a href="/dashboard" class="nav_sub_link">성과 분석</a></li>
			                                            <li class="nav_sub_item "><a href="/status/list" class="nav_sub_link">집행 현황</a></li>
			                                        </ul>
                    </li>
		                                <li class="nav_item ">
                        <a href="/campaign/list" class="nav_link"><span class="ico_nav_ico2"></span>배너 관리</a>
                        <ul class="nav_sub">
			                                            <li class="nav_sub_item "><a href="/campaign/list" class="nav_sub_link">캠페인</a></li>
			                                            <li class="nav_sub_item "><a href="/banner/list" class="nav_sub_link">배너</a></li>
			                                        </ul>
                    </li>
		                                <li class="nav_item  is_selected">
                        <a href="/site/list" class="nav_link"><span class="ico_nav_ico3"></span>영역 관리</a>
                        <ul class="nav_sub">
			                                            <li class="nav_sub_item  is_selected "><a href="/site/list" class="nav_sub_link">사이트</a></li>
			                                            <li class="nav_sub_item "><a href="/zone/list" class="nav_sub_link">영역</a></li>
			                                        </ul>
                    </li>
		                                <li class="nav_item ">
                        <a href="/segment/list" class="nav_link"><span class="ico_nav_ico4"></span>세그먼트 관리</a>
                        <ul class="nav_sub">
			                                            <li class="nav_sub_item "><a href="/segment/list" class="nav_sub_link">세그먼트 전송내역</a></li>
			                                        </ul>
                    </li>
		                                
                </ul>
            </div>
            <div class="nav_banner">
                <ul>
                    <li><a href="" target="_blank"><img src="/img/banner1.png"></a></li>
                    <li><a href="" target="_blank"><img src="/img/banner2.png"></a></li>
                </ul>
            </div>
        </nav>
        <!-- //[D] NAV -->
		<!-- content -->
		<main id="content" class="content_wrap">
		<section class="content_main">
		<div class="bg-middle content content_inner">
			<h2 class="h_tit">사이트 정보<a href="https://dighty.com/help/cm/3_2" target="_blank" class="icon_guide"><i><span class="blind">도움말</span></i></a></h2>
<script src="/js/spectrum.js"></script>
<link rel="stylesheet" href="/css/spectrum.css">

<div class="stitle1">
    <h4 class="tit"> 사이트 추가  </h4>
    <span class="pos_r">표시는 필수입력 / 선택 항목입니다.</span>
</div>

<form name="site_form" action="insert" method="get" onsubmit="return validate()">
    <input type="hidden" name="agencyid" value="1">
    <div id="num_rows">
        <input type="hidden" name="num_rows" id="num_rows" value="1">
    </div>

<table class="tbl_board1 tbl_align_l tbl_board1_mt1">
    <colgroup>
        <col width="200px">
        <col width="*">
    </colgroup>
    <tbody>
    <tr>
        <th scope="row" class="vt"><span class="point">*</span> 사이트명</th>
        <td>
            <span class="inp_txt inp_txt_wid9">
                <input type="text" name="name1" class="inp" data-toggle="tooltip" data-placement="bottom" data-html="true" data-content="1~50자 이내, 한글, 영문(대/소문자), 숫자, <br>특수문자(!%()+_=./~#), 띄어쓰기 입력 가능" placeholder="사이트명을 입력하세요." data-original-title="" title="">
            </span>
            <!-- 유효성체크 -->
            <!--ol class="check_txt">
                <dd>1~50자 이내, 한글, 영문(대/소문자), 숫자, </dd>
                <dd>특수문자(!%()+_=./~#), 띄어쓰기 입력 가능</dd>
            </ol-->
        </td>
    </tr>
    <tr>
        <th scope="row" class="vt"><span class="point">*</span> 사이트 도메인</th>
        <td>
            <span class="inp_txt inp_txt_wid9">
                <input type="text" name="website1" class="inp" placeholder="http://, https:// 값을 포함한 사이트 도메인을 입력하세요.">
            </span>
        </td>
    </tr>
    
    <tr>
        <th scope="row" class="vt"> 기본 배너 설정</th>
        <td>
            <span class="inp_txt inp_txt_wid17">
            <button type="button" name="image_label" style="display:none" onclick="delimg()" class="file_sel_name">
                        png, jpg, jpeg, gif 파일만 업로드 가능합니다.
            </button>
            <input id="orgimg" type="text" name="" class="inp fl" readonly="" placeholder="png, jpg, jpeg, gif 파일만 업로드 가능합니다.">
            <input id="file01" name="image" type="file" class="hid_input" accept="image/*" onchange="check_file(this);">
            <label for="file01" class="btn btn_fnd" style="z-index:99">파일선택</label>
            </span>
            <!-- 유효성체크 -->
            <ol class="check_txt1">     
                            <dd>기본 배너를 설정하지 않은 경우, </dd>
                <dd>노출될 배너가 없는 영역은 Dighty 기본 배너가 노출됩니다.</dd>
                        </ol>
            <!-- 배너이미지 영역  개발진행시 style="display: block" 삭제 -->
            <div class="pdl2">
            <div class="banner_area" style="display: block">
                <p class="txt_guide">
                                </p>
            </div>
            </div>
        </td>
    </tr>
    <tr>
        <th scope="row" class="vt no_line"></th>
        <td>
            <p class="txt_guide mg0t">* 기본 배너 연결 URL 설정</p>
            <span class="inp_txt inp_txt_wid9">                                       
                <input type="text" name="bannerurl1" class="inp" id="bannerurl1" placeholder="http://, https:// 값을 포함한 URL을 입력하세요." disabled="">
            </span>
        </td>
    </tr>
    <tr>
        <th scope="row" class="vt no_line"></th>
        <td>
            <p class="txt_guide mg0t">* 백그라운드 컬러 지정</p>
            <div class="color_sample" id="color_sample"></div>
            <span class="inp_txt inp_txt_wid18">                                       
                <input type="text" name="bgcolor1" id="bgcolor1" class="inp" onchange="change_color(this)" placeholder="#ffffff" disabled="">
            </span>
            <!-- 유효성체크 -->
            <ol class="check_txt2">                              
                <dd>등록된 기본 배너는 각 영역 사이즈에 맞춰 너비*높이 고정 비율 조정되어 가운데 정렬 노출됩니다.  </dd>
                <dd>기본 배너 이미지 사이즈와 영역 사이즈가 다른 경우를 위해 백그라운드 컬러를 지정해주세요.</dd>
            </ol>
        </td>
    </tr>
    </tbody>
</table>
            
<div class="btn_area pad40t">
        <button type="button" class="btn btn_xlg btn_point" onclick="checkName();">  등록  </button>
        <button type="button" class="btn btn_xlg btn_point_inline" onclick="window.location='/site/list';">취소</button>
</div>

</form>

<div id="popup_wrap" style="position: fixed; z-index: 1030; display: none;">
    <div class="dimmed"></div>
    <div class="ly_pop_wrap">
        <div class="ly_pop ly_pop_banner pad0">
            <div class="ly_header">
                <h2 class="pop_tit">원본 보기</h2> <button class="close-btn g" id="popup_close" onclick="$(&quot;#popup_wrap&quot;).css(&quot;display&quot;, &quot;none&quot;)">닫기</button>
            </div>
            <div class="ly_banner">
                <img id="preview_img">
            </div>
        </div>
    </div>
</div>



<script type="text/javascript">
$(document).ready(function(){
    bg_select();
});
// use jQuery on page load to draw the canvas image
function bg_select(){
    if(document.getElementById('cvs') != null){
        var org_image = document.getElementById('bannerimg');
        var colorsave = $('#bg_color');
        var out = $('#bgcolor1');
        var previewdiv = $('#previewdiv');
        var canvas = document.getElementById('cvs');
        var ctx = canvas.getContext('2d');

        var img = new Image();
        img.src = org_image.src;
        var img_width = org_image.style.width.replace("px", "");
        var img_height = org_image.style.height.replace("px","");

        img.onload = function(){    
            ctx.drawImage(img,0,0,img_width,img_height);
        }
        $('#cvs').bind('mousemove', function(event){
            $('#cvs').css('cursor','crosshair');
            var canvasOffset = $(canvas).offset();
            var canvasX = Math.floor(event.pageX - canvasOffset.left);
            var canvasY = Math.floor(event.pageY - canvasOffset.top);
            var imageData = ctx.getImageData(canvasX,canvasY,1,1);
            var data = imageData.data;
            var hexString = RGBtoHex(data[0],data[1],data[2]);
            if(data[3]==0){ //투명한 경우
                hexString = "FFFFFF";
            }
            hexString = "#"+hexString;
            colorsave.val(hexString);
            $('#cvs').css('backgroundColor',hexString);
        });
        $('#cvs').click(function(){
            out.val(colorsave.val());
            $('#color_sample').css('backgroundColor',colorsave.val());
        });
    }
}
function RGBtoHex(R,G,B) {return toHex(R)+toHex(G)+toHex(B)}

function toHex(N) {
    if (N==null) return "ff";
    N=parseInt(N); if (isNaN(N)) return "ff";
    N=Math.max(0,N); N=Math.min(N,255); N=Math.round(N);
    return "0123456789ABCDEF".charAt((N-N%16)/16)
        + "0123456789ABCDEF".charAt(N%16);
}

function delimg(){
    $.ajax({
        headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
        type:'POST',
        url:'/site/delimg',
        data:$('[name="site_form"]').serialize(),
        success:function(data){
            if(data=='ok'){
                $('[name="image_label"]').hide();
                $('#orgimg')[0].placeholder='png, jpg, jpeg, gif 파일만 업로드 가능합니다.';
                $(".pdl2").html('');
                $('[name="image"]').val("");
                $('.check_txt1').html('<dd>기본 배너를 설정하지 않은 경우,</dd><dd>노출될 배너가 없는 영역은 Dighty 기본 배너가 노출됩니다.</dd>');
                $('#bannerurl1').val('');
                $('#bgcolor1').val('');
                $('#bannerurl1').attr('disabled','disabled');
                $('#bgcolor1').attr('disabled','disabled');
                $('#color_sample').css('backgroundColor','#ffffff');
            }else{
                alert('이미지 파일 삭제에 실패하였습니다.');
            }
        }
    });
}
function checkName() {
    var siteData = { 
        "website"   : $('[name="website1"]').val(),
        "agencyid"   : $('[name="agencyid"]').val(),
        "affiliateid"   : $('[name="affiliateid"]').val(),
        "sitename"   : $('[name="name1"]').val(),
        "pagetype"   : $('[name="pagetype"]').val() 
    };

    $.ajax({
        type:'GET',
        url:'/site/checkSite',
        data: siteData,
        success:function(data){
            //alert(data['result'] );
            if(data['result'] == 'samename'){
                show_alert('alert', ar_107);
            }else if(data['result'] == 'sameurl'){
                show_alert('alert', ar_112);
            }else{
                if(validate()){
                    if($('[name="pagetype"]').val() == 'update'){
                        show_alert('confirm', ar_343,update);
                    }else{
                        $('[name="site_form"]').submit();
                    }
                }
            }
        }
    });
}

function update() {
    $('[name="site_form"]').submit();
}

function change_color(){
    var bgcolor = $('input[name="bgcolor1"]').val();
    //alert(bgcolor);
    var color_regex = /^#(?:[0-9a-f]{3}){1,2}$/i;
    if(bgcolor != ''){
        if(!(color_regex.test(bgcolor))){
            show_alert('alert',ar_210);
            return false;
        }else{
            $("#color_sample").css("background-color",bgcolor);
            $('#bannerimg').css("background-color",bgcolor);
        }
    }else{
        $("#color_sample").css("background-color","#FFFFFF");
    }
}
    


function check_file(e) {
    var file = e.value.split("\\");
    var name = file[file.length-1];
    var imgFormat = "\.(png|jpg|jpeg|gif)";
    if(name!=''){
        if(!(new RegExp(imgFormat,"i")).test(name)){
            show_alert('alert', ar_342);
            $('[name="image"]').val("");
            return false;   
        }
    }
    
    if(e.files[0].size > 2097152){
        show_alert('alert',ar_300);
        $('[name="image"]').val("");
        return false;
    }

    $.ajax({
       headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
       type: "POST",
       url: "upload",
       data: new FormData($('[name="site_form"]')[0]),
       contentType: false,
       processData: false,
       success: function(data)
       {
           if(data['status'] == 'success') {
                                    $('[name="image_label"]').show();
                    $('#orgimg')[0].placeholder='';
                               $('[name="image_label"]').html(data['filename']);
               $('[name="filename"]').val(data['filename']);
               $(".pdl2").html(
                   '<div class="banner" style="clear:both;"> ' +
                   '<p class="txt_guide">이미지 사이즈 : ' + data['width'] + '*' + data['height'] +
                   '<span id="popup_open"><button type="button" class="btn btn_lg btn_gray3 btn_wid8" onclick="preview_open(\'/default/' + data['filename'] + '\');">원본보기</button></span></p> ' +
                   '<div style="width:800px;height:200px;border:1px solid #ddd">' +
                   '<input type="hidden" id="bg_color">'+
                   '<img name="preview" id="bannerimg" src="/default/' + data['filename'] + '" alt="미리보기 이미지" style="width:'+data['img_width']+';height:'+data['img_height']+';display:none;"> ' +
                   '<canvas id="cvs" width="'+data['img_width']+'" height="'+data['img_height']+'"></canvas>'+
                  '</div></div> ' +
                   '<input type="hidden" name="width1" value="' + data['width'] + '"> ' +
                   '<input type="hidden" name="height1" value="' + data['height'] + '"> ' +
                   '<input type="hidden" name="filename1" value="' + data['filename'] + '"> ' +
                   '<input type="hidden" name="contenttype" value="' + data['contenttype'] + '"> '
               );
               $(".check_txt1").html("");
               $('#bannerurl1').removeAttr('disabled');
               $('#bgcolor1').removeAttr('disabled');
               $('#bgcolor1').val('#ffffff');
               bg_select();
               show_alert('success', ar_312);
           } else {
               show_alert('alert', ar_342);
               $('[name="image_label"]').html("");
               $('[name="filename"]').val("");
           }
       },
       error: function(request,status,error) {
            $('[name="image_label"]').html("png, jpg, jpeg, gif 파일만 업로드 가능합니다.");   
            show_alert('alert', ar_355);
       }
     });
}

$("img").error(function(){
    $(this).replaceWith('<p style="width:100%;vertical-align:middle;">[Broken Image Link]</p>');
});

$('[name="bgcolor1"]').keydown(function(event) {
    if (event.keyCode === 13) {
        change_color();
        event.preventDefault();
        return false;
    }
});

function validate() {
    var sitename = $('input[name*="name1"]').map(function(idx, elem) { return $(elem).val(); }).get();
    var siteurl = $('input[name*="website"]').map(function(idx, elem) { return $(elem).val(); }).get();
    var bannerurl = $('input[name*="bannerurl"]').map(function(idx, elem) { return $(elem).val(); }).get();
    var colorval = $('input[name="bgcolor1"]').val();
    var color_regex = /^#(?:[0-9a-f]{3}){1,2}$/i;
    var uploadfile = $('input[name="filename1"]').val();
    
    for(i=0; i<sitename.length; i++) {
        if(sitename[i] == '') {
            show_alert('alert', ar_320);
            return false;
        } else {
            if(sitename[i].length > 50){
                show_alert('alert', ar_207);
                return false;
            }
            if(!is_name(sitename[i])) {
                return false;
            }
            for(j=i+1; j<sitename.length; j++) {
                if(sitename[i] == sitename[j]) {
                    show_alert('alert', ar_331);
                    return false;
                }
            }
        }
    }
    for(i=0; i<siteurl.length; i++) {
        if(siteurl[i] == '') {
            show_alert('alert', ar_213);
            return false;
        } else {
            regexp = /https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/;
            if (!regexp.test(siteurl[i])) {
                show_alert('alert', ar_214);
                return false;
            }
            for(j=i+1; j<siteurl.length; j++) {
                if(siteurl[i] == siteurl[j]) {
                    show_alert('alert', ar_333);
                    return false;
                }
            }
        }
    }
    if(bannerurl != '' || colorval != ''){
        if(!uploadfile){
            show_alert('alert', ar_311);
            return false;
        }
    }
    if(uploadfile){
        if(bannerurl == ''){
            show_alert('alert',ar_215);
            return false;
        }else{
            regexp = /https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/;
            if (!regexp.test(bannerurl)) {
                show_alert('alert', ar_216);
                return false;
            }
        }
        if(colorval == ''){
            show_alert('alert',ar_211);
            return false;
        }
        if(colorval != ''){
            if(!(color_regex.test(colorval))){
                show_alert('alert',colorval);
                show_alert('alert',ar_210);
                return false;
            }
        }
    }
    return true;
}

function preview_open(filename) {
    $('#preview_img').attr('src', filename);
    $("#popup_wrap").css("display", "block"); 
}
</script>
		</div>
		</section>
		</main>
		<!-- //content -->
	
	<div class="modal fade" id="customModal" tabindex="-1" aria-labelledby="customModalLabel" aria-hidden="true" data-keyboard="false">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <!--
      <div class="modal-header">
        <h4 class="modal-title" id="myModalLabel"></h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" style="font-size:18px;">&times;</span></button>
      </div>
      -->

      <div class="modal-body">
      </div>


      <div class="modal-footer">
      </div>


    </div>
  </div>
</div>
	<!-- //container -->

	<!-- [D] FOOTER -->
        <footer class="dighty_footer">
            <div class="copy_link">© NHN ACE Corp. All rights reserved. </div>
            <ul class="coustom_lst">
                <li class="coustom_item">고객지원센터 <span class="color-point">1544-5420</span></li>
            </ul>
        </footer>
        <!-- //[D] FOOTER -->
	</div>
</div>

<script>
$(function() {
    // am cm 선택 박스 기능
    $(".dighty_brand").mouseover(function() {
        $("#brand_layer").css("display", "block");
    }).mouseout(function() {
        $("#brand_layer").css("display", "none");
    });
    $("#brand_layer").mouseover(function() {
        $("#brand_layer").css("display", "block");
    }).mouseout(function() {
        $("#brand_layer").css("display", "none");
    });
});

// 크롬 이외 브라우저 배너 노출
var userAgent = window.navigator.userAgent;
var isChrome = userAgent.indexOf('Chrome');
var isChromeMobile = userAgent.indexOf('CriOS');
var isSamsungBrowser = userAgent.indexOf('SamsungBrowser');
var isWindows = userAgent.indexOf('Windows NT');
var isEdge = userAgent.indexOf('Edge');
var isIE = userAgent.indexOf('Trident');
var isWhale = userAgent.indexOf('Whale');

if( (isChrome < 0 && isChromeMobile < 0) || ( isEdge > -1 ) || ( isWhale > -1 ) ) {
    $('.main_top_wrap').css('display', 'block');
    $('.dighty_header').css('top','36px');
    $('.dighty_nav').css('top','116px');
    $('.content_wrap').css('top','36px');
}
function closeWrap() {
    $('.main_top_wrap').remove();
    $('.dighty_header').css('top','0');
    $('.dighty_nav').css('top','81px');
    $('.content_wrap').css('top','0');
}
</script>




</body></html>